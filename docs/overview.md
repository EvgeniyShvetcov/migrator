# Обзор

ThinkingHome.Migrator —  система контроля версий базы данных для .NET Core, похожая на EntityFramework Migrations. Цель — автоматизировать внесение изменений в БД (например, при развертывании или обновлении приложения) и обеспечить контроль версий БД.

## Основная идея

Все изменения БД записываются в виде *миграций* — классов, написанных на языке программирования (например, на C#).

Каждый класс миграции наследуется от базового класса `ThinkingHome.Migrator.Framework.Migration` и реализует его методы `Apply` (применить изменения) и `Revert` (откатить изменения).

Внутри этих методов разработчик при помощи [специального API](writing-migrations.md) описывает действия, которые нужно выполнить над БД. Например, добавление колонки будет выглядеть так:

```c#
public override void Apply()
{
    Database.AddColumn("Table1", new Column("Num", DbType.Int32));
}
```

Есть также возможность выполнить произвольный SQL.

## Контроль версий

Для каждой миграции указывается номер версии, в которую перейдет БД после внесения описанных в миграции изменений.

Учет версий ведется автоматически: информация о выполненных миграциях сохраняется в БД в специальной таблице. Имея сборку с миграциями, в которых реализованы методы `Apply` и `Revert`, можно обновить БД любой версии до любой другой версии (как выше, так и ниже текущей).

> В отличие от миграций EntityFramework, ThinkingHome.Migrator может вести в одной БД учет версий для нескольких независимых приложений. Например, это может быть полезно, если вы пишете модульное приложение, каждый модуль которого имеет собственную структуру БД и может независимо обновляться.   

## Поддерживаемые СУБД

ThinkingHome.Migrator предоставляет одинаковый API для управления разными СУБД. При запуске миграций нужно указать название *провайдера трансформации*, который будет генерировать SQL запросы для нужной СУБД. 

В проекте ThinkingHome.Migrator уже реализованы провайдеры для MS SQL Server, PostgreSQL, MySQL, SQLite. Вы можете [реализовать провайдер](development.md) для любой нужной СУБД.

## Выполнение миграций

Для применения миграций нужно скомпилировать код их классов в файл `.dll`. После этого вы можете применить изменения с помощью консольного приложения `migrate-database`, которое устанавливается [из NuGet](https://www.nuget.org/packages/ThinkingHome.Migrator.CLI) как .NET Core global tool.

```bash
migrate-database postgres "host=localhost;port=5432;database=test;" /path/to/migrations.dll 
```

Также вы можете выполнить миграции из своего приложения на .NET Core, используя API мигратора. Например, вы можете написать приложение, которое при запуске само создает себе нужную структуру БД. 

## Далее ##
[Начало работы](getting-started.md) 
